(()=>{"use strict";var t={187:t=>{var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}t.exports=i,t.exports.once=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}v(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&v(t,"error",e,{once:!0})}(t,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function s(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function c(t,e,n,r){var o,i,a,c;if(s(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),a=i[e]),void 0===a)a=i[e]=n,++t._eventsCount;else if("function"==typeof a?a=i[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=u(t))>0&&a.length>o&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=a.length,c=l,console&&console.warn&&console.warn(c)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=l.bind(r);return o.listener=n,r.wrapFn=o,o}function d(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):h(o,o.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function v(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var o="error"===t,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)r(u,this,e);else{var c=u.length,l=h(u,c);for(n=0;n<c;++n)r(l[n],this,e)}return!0},i.prototype.addListener=function(t,e){return c(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return c(this,t,e,!0)},i.prototype.once=function(t,e){return s(e),this.on(t,f(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,f(this,t,e)),this},i.prototype.removeListener=function(t,e){var n,r,o,i,a;if(s(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},i.prototype.listeners=function(t){return d(this,t,!0)},i.prototype.rawListeners=function(t){return d(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{const t=function(t,e,n,r){var o=document.createElement(t);return e&&(o.className=e),n&&(o.innerText=n),r&&r.append(o),o};const e=function(e,n,r,o,i){var a=this;this.changePage=function(t){a.header.setButton(t),a.main.innerHTML="",a.main.appendChild("garage"===t?a.garage.render():a.winners.render())},this.start=function(){document.body.append(a.header.render(),a.main,a.footer.render())},this.header=e,this.main=t("main","main"),this.footer=n,this.header.on("chagePage",(function(t){return a.changePage(t)})),this.garage=r,this.winners=o,this.controller=i,this.main.appendChild(this.garage.render())},r=n.p+"4ab7ace061320f574e8a.svg",o=function(e,n){var o=t("div"),i=n?'<svg style="fill: '.concat(n,'">'):"<svg>";return i+='<use href="'.concat(r,"#").concat(e,'"></use>\n                 </svg>'),o.innerHTML=i,o};var i=n(187),a=n.n(i),s=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},u=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};const c=new(function(){function t(t){this.url=t}return t.prototype.request=function(t,e,n){return void 0===n&&(n=void 0),s(this,void 0,void 0,(function(){var r,o,i,a,s,c;return u(this,(function(u){switch(u.label){case 0:r={method:e||void 0,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0},u.label=1;case 1:return u.trys.push([1,6,,7]),[4,fetch("".concat(this.url).concat(t),r)];case 2:return o=u.sent(),i=o.status,c=o.headers.get("X-Total-Count")||"0",200!==o.status?[3,4]:[4,o.json()];case 3:return a=u.sent(),[3,5];case 4:a={success:!1},u.label=5;case 5:return[2,{result:a,total:c,status:i}];case 6:return(s=u.sent())instanceof Error&&console.log(s.message),[2,{result:[],total:c="0",status:404}];case 7:return[2]}}))}))},t.prototype.getCars=function(t,e){return s(this,void 0,void 0,(function(){var n,r,o;return u(this,(function(i){switch(i.label){case 0:return[4,this.request("garage?_page=".concat(t,"&_limit=").concat(e),"GET")];case 1:return n=i.sent(),r=n.result,o=n.total,[2,{items:r,count:o}]}}))}))},t.prototype.getCar=function(t){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.request("garage?id=".concat(t),"GET")];case 1:return[2,e.sent().result]}}))}))},t.prototype.createCar=function(t){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.request("garage","POST",t)];case 1:return[2,e.sent().result]}}))}))},t.prototype.deleteCar=function(t){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.request("garage/".concat(t),"DELETE")];case 1:return[2,e.sent().result]}}))}))},t.prototype.updateCar=function(t,e){return s(this,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,this.request("garage/".concat(t),"PUT",e)];case 1:return[2,n.sent().result]}}))}))},t.prototype.startStopEngineCar=function(t,e){return s(this,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:return[4,this.request("engine?id=".concat(t,"&status=").concat(e),"PATCH")];case 1:return[2,(n=r.sent().result).distance/n.velocity]}}))}))},t.prototype.driveCar=function(t){return s(this,void 0,void 0,(function(){var e,n,r;return u(this,(function(o){switch(o.label){case 0:return[4,this.request("engine?id=".concat(t,"&status=drive"),"PATCH")];case 1:return e=o.sent(),n=e.result,r=e.status,[2,{result:n,status:r}]}}))}))},t.prototype.getWinnersCars=function(t,e,n,r){return void 0===n&&(n="id"),void 0===r&&(r="ASC"),s(this,void 0,void 0,(function(){var o,i,a;return u(this,(function(s){switch(s.label){case 0:return[4,this.request("winners?_page=".concat(t,"&_limit=").concat(e,"&_sort=").concat(n,"&_order=").concat(r),"GET")];case 1:return o=s.sent(),i=o.result,a=o.total,[2,{items:i,count:a}]}}))}))},t.prototype.getWinnersCar=function(t){return s(this,void 0,void 0,(function(){var e,n,r;return u(this,(function(o){switch(o.label){case 0:return[4,this.request("winners?id=".concat(t),"GET")];case 1:return e=o.sent(),n=e.result,r=e.status,[2,{items:n,status:r}]}}))}))},t.prototype.createWinnersCar=function(t){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.request("winners","POST",t)];case 1:return[2,e.sent().result]}}))}))},t.prototype.deleteWinnersCar=function(t){return s(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.request("winners/".concat(t),"DELETE")];case 1:return[2,e.sent().result]}}))}))},t.prototype.updateWinnersCar=function(t,e){return s(this,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,this.request("winners/".concat(t),"PUT",e)];case 1:return[2,n.sent().result]}}))}))},t}())("http://127.0.0.1:3000/"),l=n.p+"226309e670b7cd7602ec.mp3",f=n.p+"96822cb60c67c1ef2ae2.mp3",d=n.p+"7fb12c65664046de0ea6.mp3";var p=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},h=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};const v=function(t,e){var n=this;this.startCar=function(){return p(n,void 0,void 0,(function(){var t;return h(this,(function(e){switch(e.label){case 0:return this.preStart(),[4,this.startEngine()];case 1:return t=e.sent(),this.startAnimation(t),this.drive(),[2]}}))}))},this.stop=function(){return p(n,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.model.preStop(),[4,this.stopEngine()];case 1:return t.sent(),this.isSrart?this.model.stop():this.isStop=!0,this.player.pause(),this.model.stopAnimation(),this.model.returnCar(),[2]}}))}))},this.preStart=function(){n.model.preStart(),n.isSrart=!1,n.isStop=!1},this.startAnimation=function(t){n.model.startAnimation(t),setTimeout((function(){n.player.src=d,n.player.play()}),500*Math.random())},this.startEngine=function(){return p(n,void 0,void 0,(function(){var t=this;return h(this,(function(e){return this.player.src=l,setTimeout((function(){return t.player.play()}),500*Math.random()),[2,c.startStopEngineCar(this.model.car.id,"started")]}))}))},this.stopEngine=function(){return p(n,void 0,void 0,(function(){return h(this,(function(t){return[2,c.startStopEngineCar(this.model.car.id,"stopped")]}))}))},this.drive=function(){return p(n,void 0,void 0,(function(){var t,e,n,r,o;return h(this,(function(i){switch(i.label){case 0:return[4,c.driveCar(this.model.car.id)];case 1:return t=i.sent(),e=this.model,n=e.id,r=e.name,o=e.speed,this.stopDrive(t),[2,{driveStatus:t,id:n,name:r,speed:o}]}}))}))},this.stopDrive=function(t){500===t.status&&(n.model.stopAnimation(),n.player.src=f,n.isStop||n.player.play()),t.result.success&&n.player.pause(),n.isStop?n.model.stop():n.isSrart=!0},this.model=t,this.view=e,this.isSrart=!1,this.isStop=!1,this.player=new Audio,this.player.volume=.4,this.view.on("start",this.startCar),this.view.on("stop",this.stop)};var m,b=(m=function(t,e){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},m(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const y=function(t){function e(e){var n=t.call(this)||this;return n.preStart=function(){n.isStartDissabled=!0,n.isStopDissabled=!1,n.isEditDissabled=!0,n.isDeleteDissabled=!0,n.emit("preStart")},n.startAnimation=function(t){n.speed=t,n.emit("startAnimation",t)},n.stopAnimation=function(){n.emit("stopAnimation")},n.preStop=function(){n.isStopDissabled=!0,n.emit("updateButtons")},n.stop=function(){n.isStartDissabled=!1,n.isEditDissabled=!1,n.isDeleteDissabled=!1,n.emit("updateButtons")},n.returnCar=function(){n.emit("returnCar")},n.car=e,n.id=e.id,n.name=e.name,n.speed=0,n.isStartDissabled=!1,n.isStopDissabled=!0,n.isEditDissabled=!1,n.isDeleteDissabled=!1,n}return b(e,t),e.prototype.emit=function(e,n){return t.prototype.emit.call(this,e,n)},e.prototype.on=function(e,n){return t.prototype.on.call(this,e,n)},e}(a()),g=function(e,n,r,o){var i=t("button",e,n,o);return r&&(i.disabled=!0),i};var w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const C=function(e){function n(n){var r=e.call(this)||this;return r.createTracButton=function(t){return g("button button__trac",t,!1)},r.createTrac=function(e,n){var i=t("div","trac__buttons","",r.element);t("div","trac__buttonsGroup","",i).append(r.buttonStart,r.buttonStop),t("div","trac__buttonsGroup","",i).append(r.buttonEdit,r.buttonDelete),r.element.appendChild(r.road),t("p","nameCar",e,r.road),r.road.appendChild(r.car),r.car.appendChild(o("car",n))},r.preStart=function(){r.updateButtons(),r.setDistance()},r.updateButtons=function(){r.buttonStart.disabled=r.model.isStartDissabled,r.buttonStop.disabled=r.model.isStopDissabled,r.buttonEdit.disabled=r.model.isEditDissabled,r.buttonDelete.disabled=r.model.isDeleteDissabled},r.startAnimation=function(t){var e=0,n=r.distance/(t/1e3*60),o=function(){if(e+=n,r.setStyle(e),e<r.distance){var t=requestAnimationFrame(o);r.setAnimationId(t)}};o()},r.setDistance=function(){r.distance=r.road.offsetWidth-r.car.offsetWidth},r.stopAnimation=function(){cancelAnimationFrame(r.animationId)},r.returnCar=function(){r.setStyle(0)},r.setStyle=function(t){r.car.style.transform="translateX(".concat(t,"px)")},r.setAnimationId=function(t){r.animationId=t},r.render=function(){return r.element},r.model=n,r.id=r.model.car.id,r.animationId=null,r.element=t("div","trac"),r.buttonStart=r.createTracButton("start"),r.buttonStart.disabled=r.model.isStartDissabled,r.buttonStop=r.createTracButton("stop"),r.buttonStop.disabled=r.model.isStopDissabled,r.buttonEdit=r.createTracButton("edit"),r.buttonEdit.disabled=r.model.isEditDissabled,r.buttonDelete=r.createTracButton("delete"),r.buttonDelete.disabled=r.model.isDeleteDissabled,r.road=t("div","trac__road"),r.car=t("div","trac__car"),r.createTrac(r.model.car.name,r.model.car.color),r.buttonStart.addEventListener("click",(function(){return r.emit("start")})),r.buttonStop.addEventListener("click",(function(){return r.emit("stop")})),r.model.on("preStart",r.preStart),r.model.on("startAnimation",(function(t){return r.startAnimation(t)})),r.model.on("stopAnimation",r.stopAnimation),r.model.on("updateButtons",r.updateButtons),r.model.on("returnCar",r.returnCar),r}return w(n,e),n.prototype.emit=function(t,n){return e.prototype.emit.call(this,t,n)},n.prototype.on=function(t,n){return e.prototype.on.call(this,t,n)},n}(a()),_=function(t){var e=this;this.render=function(){return e.element},this.model=new y(t),this.view=new C(this.model),this.controller=new v(this.model,this.view),this.element=this.view.render()};var P,S;!function(t){t[t.id=1]="id",t.name="Mosckvich",t.color="#ff0000",t[t.win=1]="win",t[t.time=10]="time"}(P||(P={})),function(t){t[t.cars=7]="cars",t[t.wins=10]="wins"}(S||(S={}));var E=["Aston Martin","Audi","BMW","Citroen","Chevrolet","Dodge","Lada","Mersedes","Nissan","Opel","Reno","Subaru","Tesla","Toyota"],x=["Almera","C3","C4","Daster","Corola","Caravan","Pajero","Megan","Pathfander","Priora","Tundra","X5","X-trail"],T=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const O=function(t){function e(){var e=t.call(this)||this;return e.getCars=function(){return t=e,n=void 0,o=function(){return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}(this,(function(t){return[2]}))},new((r=void 0)||(r=Promise))((function(e,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(t){t(n)}))).then(a,s)}u((o=o.apply(t,n||[])).next())}));var t,n,r,o},e.updateItemsCars=function(t){e.countCars=t,e.countPages=Math.ceil(e.countCars/e.limitCars),e.currentPage>e.countPages&&e.currentPage>1&&(e.currentPage=e.countPages,e.getCars()),e.setButtonsPagination()},e.setButtonsPagination=function(){e.currentPage<=1?e.isPrevDisabled=!0:e.isPrevDisabled=!1,e.currentPage>=e.countPages?e.isNextDisabled=!0:e.isNextDisabled=!1},e.nextPage=function(){e.currentPage<e.countPages&&(e.currentPage+=1,e.getCars())},e.prevPage=function(){e.currentPage>1&&(e.currentPage-=1,e.getCars())},e.cars=[],e.countCars=0,e.limitCars=1,e.currentPage=1,e.countPages=1,e.isPrevDisabled=!0,e.isNextDisabled=!0,e}return T(e,t),e.prototype.emit=function(e,n){return t.prototype.emit.call(this,e,n)},e.prototype.on=function(e,n){return t.prototype.on.call(this,e,n)},e}(a());var D=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),L=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},A=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};const j=function(t){function e(){var e=t.call(this)||this;return e.getCars=function(){return L(e,void 0,void 0,(function(){var t,e,n;return A(this,(function(r){switch(r.label){case 0:return[4,c.getCars(this.currentPage,S.cars)];case 1:return t=r.sent(),e=t.items,n=t.count,this.cars=e,this.getTracs(),this.updateItemsCars(Number(n)),this.emit("updateCars"),[2]}}))}))},e.getTracs=function(){e.tracs=e.cars.map((function(t){return new _(t)}))},e.createCar=function(t,n){return L(e,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return this.isEdit?[4,c.updateCar(this.editId,{name:t,color:n})]:[3,2];case 1:return e.sent(),this.isEdit=!1,this.isGenCarsDisabled=!1,this.emit("updateWinners"),this.emit("updateButtons"),[3,4];case 2:return[4,c.createCar({name:t,color:n})];case 3:e.sent(),e.label=4;case 4:return this.getCars(),[2]}}))}))},e.createCars=function(){return L(e,void 0,void 0,(function(){var t,e,n;return A(this,(function(r){for(this.isEdit=!1,this.isGenCarsDisabled=!1,this.emit("updateButtons"),t=0;t<100;t+=1)e="#".concat(Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")),n="".concat(E[Math.floor(Math.random()*E.length)]," ").concat(x[Math.floor(Math.random()*x.length)]),this.createCar(n,e);return[2]}))}))},e.deleteCar=function(t){return L(e,void 0,void 0,(function(){return A(this,(function(e){switch(e.label){case 0:return[4,c.deleteCar(t)];case 1:return e.sent(),this.getCars(),[2]}}))}))},e.setEditCar=function(t){e.editId===t.car.id?e.isEdit=!e.isEdit:e.isEdit=!0,e.editId=t.car.id,e.isGenCarsDisabled=e.isEdit,e.nameCar=t.car.name,e.colorCar=t.car.color,e.emit("updateImput"),e.emit("updateButtons")},e.startRace=function(){e.isCreateCarDisabled=!0,e.isGenCarsDisabled=!0,e.isResetDisabled=!1,e.isStartDisabled=!0,e.emit("updateButtons")},e.stopRace=function(){e.isCreateCarDisabled=!1,e.isGenCarsDisabled=e.isEdit,e.isResetDisabled=!0,e.isStartDisabled=!1,e.emit("updateButtons")},e.isEdit=!1,e.editId=0,e.tracs=[],e.nameCar=P.name,e.colorCar=P.color,e.limitCars=S.cars,e.isGenCarsDisabled=!1,e.isCreateCarDisabled=!1,e.isResetDisabled=!0,e.isStartDisabled=!1,e.getCars(),e}return D(e,t),e}(O),k=function(e,n){var r=t("input",e);return r.type=n,r},B=function(e,n,r,o){var i=t("div","".concat(e,"__buttons"),"");return t("div","pagination__buttons","",i).append(n,r,o),i};var W=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const N=function(e){function n(n){var r=e.call(this)||this;return r.setButtonsPagination=function(){r.buttonPrev.disabled=r.model.isPrevDisabled,r.buttonNext.disabled=r.model.isNextDisabled},r.render=function(){return r.element},r.model=n,r.countCars=t("span","","".concat(r.model.countCars)),r.buttonPrev=g("button tracs__prev","prev",r.model.isPrevDisabled),r.buttonNext=g("button tracs__next","next",r.model.isNextDisabled),r.paginationText=t("div","tracs__countPages","".concat(r.model.currentPage," / ").concat(r.model.countPages)),r.buttonPrev.addEventListener("click",(function(){return r.emit("prevPage")})),r.buttonNext.addEventListener("click",(function(){return r.emit("nextPage")})),r}return W(n,e),n.prototype.emit=function(t,n,r){return e.prototype.emit.call(this,t,n,r)},n.prototype.on=function(t,n){return e.prototype.on.call(this,t,n)},n}(a());var G,R=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.Create="Create new car",t.Edit="Edit car"}(G||(G={}));const M=function(e){function n(n){var r=e.call(this,n)||this;return r.createGarageTitle=function(){var e=t("div","garage__title","",r.element),n=t("div","createCarButtons","",e),o=t("div","generateButtons","",n),i=t("p","","",o);t("span","","Cars in garage: ",i),i.appendChild(r.countCars),o.appendChild(r.buttonGenCar),t("div","createCar","",n).append(r.inputName,r.inputColor,r.buttonCreateCar),t("div","startResetButtons","",e).append(r.buttonReset,r.buttonStart)},r.updateCars=function(){var t;r.countCars.innerText="".concat(r.model.countCars),r.paginationText.innerText="".concat(r.model.currentPage," / ").concat(r.model.countPages),r.setButtonsPagination(),r.tracksContainer.innerHTML="",(t=r.tracksContainer).append.apply(t,r.model.tracs.map((function(t){return t.view.buttonEdit.addEventListener("click",(function(){return r.emit("editCar",t.model)})),t.view.buttonDelete.addEventListener("click",(function(){return r.emit("deleteCar",t.view.id)})),t.render()})))},r.updateButtons=function(){r.buttonCreateCar.innerText=r.model.isEdit?G.Edit:G.Create,r.buttonCreateCar.disabled=r.model.isCreateCarDisabled,r.buttonGenCar.disabled=r.model.isGenCarsDisabled,r.buttonReset.disabled=r.model.isResetDisabled,r.buttonStart.disabled=r.model.isStartDisabled},r.updateInput=function(){r.inputName.value=r.model.nameCar,r.inputColor.value=r.model.colorCar},r.setListener=function(){r.buttonCreateCar.addEventListener("click",(function(){return r.emit("createCar",r.inputName.value,r.inputColor.value)})),r.buttonGenCar.addEventListener("click",(function(){return r.emit("create100")})),r.buttonStart.addEventListener("click",(function(){return r.emit("startRace")})),r.buttonReset.addEventListener("click",(function(){return r.emit("stopRace")}))},r.element=t("div","garage"),r.buttonGenCar=g("button button__generateCars","Generate 100 cars"),r.buttonCreateCar=g("button button__newCar",G.Create),r.buttonReset=g("button returnCars","Reset",!0),r.buttonStart=g("button startCars","Start"),r.inputName=k("inputText","text"),r.inputName.value=r.model.nameCar,r.inputColor=k("inputColor","color"),r.inputColor.value=r.model.colorCar,r.createGarageTitle(),r.tracksContainer=t("div","tracs__container","",r.element),r.element.appendChild(B("tracs",r.buttonPrev,r.paginationText,r.buttonNext)),r.setListener(),r.model.on("updateCars",r.updateCars),r.model.on("updateButtons",r.updateButtons),r.model.on("updateImput",r.updateInput),r}return R(n,e),n}(N);var I=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const q=function(t){function e(){var e=t.call(this)||this;return e.render=function(){return e.element},e.model=new j,e.view=new M(e.model),e.element=e.view.render(),e}return I(e,t),e}(a());var F=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const H=function(e){function n(){var n=e.call(this)||this;n.setButton=function(t){switch(t){case"garage":n.buttonGarage.disabled=!0,n.buttonGarage.classList.add("active"),n.buttonWinners.disabled=!1,n.buttonWinners.classList.remove("active");break;case"winners":n.buttonGarage.disabled=!1,n.buttonGarage.classList.remove("active"),n.buttonWinners.disabled=!0,n.buttonWinners.classList.add("active")}},n.render=function(){return n.header},n.header=t("header","header");var r=t("div","header__container","",n.header),o=t("div","header__buttons","",r);return n.buttonGarage=g("button button__garage active","Garage",!0,o),n.buttonGarage.addEventListener("click",(function(){return n.emit("chagePage","garage")})),n.buttonWinners=g("button button__winners","Winners",!1,o),n.buttonWinners.addEventListener("click",(function(){return n.emit("chagePage","winners")})),t("h1","","ASYNC RACE",r),n}return F(n,e),n.prototype.emit=function(t,n){return e.prototype.emit.call(this,t,n)},n.prototype.on=function(t,n){return e.prototype.on.call(this,t,n)},n}(a());var U=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),X=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},$=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},K=function(t){function e(){var e=t.call(this)||this;return e.getCars=function(t,n){return void 0===t&&(t=e.sort),void 0===n&&(n=e.order),X(e,void 0,void 0,(function(){var e,r,o,i;return $(this,(function(a){switch(a.label){case 0:return[4,c.getWinnersCars(this.currentPage,S.wins,t,n)];case 1:return e=a.sent(),r=e.items,o=e.count,this.cars=r,this.updateItemsCars(Number(o)),i=this,[4,this.getWinnersProp(this.currentPage)];case 2:return i.winners=a.sent(),this.emit("updateCars"),[2]}}))}))},e.getWinnersProp=function(t){return X(e,void 0,void 0,(function(){var e,n,r,o=this;return $(this,(function(i){switch(i.label){case 0:return e=[],n=[],this.cars.map((function(t){return X(o,void 0,void 0,(function(){var e,r;return $(this,(function(o){return e=t.id?t.id:P.id,r=c.getCar(e),n.push(r),[2]}))}))})),[4,Promise.all(n)];case 1:return(r=(r=i.sent()).filter((function(t){return t.length}))).length<this.cars.length&&(this.cars.forEach((function(t){r.find((function(e){return e[0].id===t.id}))||c.deleteWinnersCar(t.id)})),this.getCars()),r.forEach((function(n,r){var i=n[0],a=o.cars.find((function(t){return t.id===(null==i?void 0:i.id)}));if(i){var s={id:i.id||P.id,num:(t-1)*S.wins+r+1,fill:i.color||P.color,name:i.name||P.name,wins:a.wins||P.win,time:a.time||P.time};e.push(s)}})),[2,e]}}))}))},e.deleteCar=function(t){return X(e,void 0,void 0,(function(){return $(this,(function(e){switch(e.label){case 0:return[4,c.deleteWinnersCar(t)];case 1:return e.sent(),this.getCars(),[2]}}))}))},e.sortWinners=function(t){t===e.sort?e.order="ASC"===e.order?"DESC":"ASC":(e.sort=t,e.order="ASC"),e.getCars(e.sort,e.order),e.emit("updateColumnsName")},e.winners=[],e.limitCars=S.wins,e.sort="id",e.order="ASC",e.getCars(),e}return U(e,t),e}(O);const J=K;var Y,z,Q=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.Default="Wins number",t.ABC="Wins number ↓",t.DESC="Wins number ↑"}(Y||(Y={})),function(t){t.Default="Best time",t.ABC="Best time ↓",t.DESC="Best time ↑"}(z||(z={}));const V=function(e){function n(n){var r=e.call(this,n)||this;r.getColumnsName=function(){return{winText:"wins"===r.model.sort?"ASC"===r.model.order?Y.ABC:Y.DESC:Y.Default,timeText:"time"===r.model.sort?"ASC"===r.model.order?z.ABC:z.DESC:z.Default}},r.setColumnsName=function(){var t=r.getColumnsName(),e=t.winText,n=t.timeText;r.winColumn.innerText=e,r.timeColumn.innerText=n},r.createWinners=function(){t("h2","","Winners",r.element);var e=t("div","winners__container","",r.element),n=t("p","","",e);t("span","","Total winners: ",n),n.appendChild(r.countCars),e.appendChild(r.table),e.appendChild(B("winners",r.buttonPrev,r.paginationText,r.buttonNext)),r.createTableTitle()},r.createTableTitle=function(){t("div","winners__number","№",r.table),t("div","winners__img","Car",r.table),t("div","winners__name","Name",r.table),r.table.append(r.winColumn,r.timeColumn)},r.updateCars=function(){r.countCars.innerText="".concat(r.model.countCars),r.paginationText.innerText="".concat(r.model.currentPage," / ").concat(r.model.countPages),r.setButtonsPagination(),r.table.innerHTML="",r.createTableTitle(),r.model.winners.forEach((function(e){t("div","winners__number","".concat(e.num),r.table),t("div","winners__img","",r.table).appendChild(o("car",e.fill)),t("div","winners__name","".concat(e.name),r.table),t("div","winners__wins","".concat(e.wins),r.table),t("div","winners__time","".concat(e.time),r.table)}))},r.element=t("div","winners"),r.table=t("div","winners__table");var i=r.getColumnsName(),a=i.winText,s=i.timeText;return r.winColumn=t("div","winners__wins cursor","".concat(a)),r.timeColumn=t("div","winners__time cursor","".concat(s)),r.createWinners(),r.model.on("updateCars",r.updateCars),r.model.on("updateColumnsName",r.setColumnsName),r.winColumn.addEventListener("click",(function(){return r.emit("sort","wins")})),r.timeColumn.addEventListener("click",(function(){return r.emit("sort","time")})),r}return Q(n,e),n}(N);var Z=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const tt=function(t){function e(){var e=t.call(this)||this;return e.render=function(){return e.element},e.model=new J,e.view=new V(e.model),e.element=e.view.render(),e}return Z(e,t),e}(a()),et=function(){var e=this;this.show=function(t,n){e.title.innerText="".concat(t," wont first ").concat(n,"s!"),document.body.append(e.element)},this.hide=function(){e.element.remove()},this.element=t("div","modal-page"),this.title=t("h1","modal-title","",this.element),this.element.addEventListener("click",this.hide)};var nt=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},rt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},ot=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};const it=function(t,e){var n=this;this.startRace=function(){return nt(n,void 0,void 0,(function(){var t,e,n,r,o;return rt(this,(function(i){switch(i.label){case 0:return this.isStop=!1,this.garage.model.startRace(),t=ot([],this.garage.model.tracs,!0),e=t.map((function(t){return t.controller.preStart(),t.controller.startEngine()})),[4,Promise.all(e)];case 1:return n=i.sent(),r=t.map((function(t,e){return t.controller.startAnimation(n[e]),t.controller.drive()})),[4,this.getWinner(r,t)];case 2:return o=i.sent(),this.isStop||o&&o.id&&(this.modal.show(o.name,o.time),this.updateWinners(o)),[2]}}))}))},this.updateWinners=function(t){return nt(n,void 0,void 0,(function(){var e,n,r;return rt(this,(function(o){switch(o.label){case 0:return[4,c.getWinnersCar(t.id)];case 1:return e=o.sent().items,(n=ot([],e,!0)[0])&&n.id?[3,3]:[4,c.createWinnersCar(t)];case 2:return o.sent(),[3,5];case 3:return r={id:t.id,wins:n.wins+1,time:t.time<=n.time?t.time:n.time},[4,c.updateWinnersCar(t.id,r)];case 4:o.sent(),o.label=5;case 5:return this.winners.model.getCars(),[2]}}))}))},this.getWinner=function(t,e){return nt(n,void 0,void 0,(function(){var n,r,o,i,a,s,u,c;return rt(this,(function(l){switch(l.label){case 0:return[4,Promise.race(t)];case 1:return n=l.sent(),r=n.driveStatus,o=n.id,i=n.name,a=n.speed,r.result.success?[2,{id:o,name:i,time:Number((a/1e3).toFixed(2))}]:(s=e.findIndex((function(t){return t.model.id===o})),u=ot(ot([],t.slice(0,s),!0),t.slice(s+1),!0),c=ot(ot([],e.slice(0,s),!0),e.slice(s+1),!0),[2,this.getWinner(u,c)])}}))}))},this.stopRace=function(){n.isStop=!0,n.garage.model.stopRace(),n.garage.model.tracs.forEach((function(t){t.controller.stop()}))},this.garage=t,this.winners=e,this.modal=new et,this.isStop=!1,this.garage.view.on("createCar",(function(t,e){return n.garage.model.createCar(t,e)})),this.garage.view.on("create100",(function(){return n.garage.model.createCars()})),this.garage.view.on("prevPage",(function(){return n.garage.model.prevPage()})),this.garage.view.on("nextPage",(function(){return n.garage.model.nextPage()})),this.garage.view.on("editCar",(function(t){return n.garage.model.setEditCar(t)})),this.garage.model.on("updateWinners",this.winners.model.getCars),this.garage.view.on("deleteCar",(function(t){n.garage.model.deleteCar(t),n.winners.model.deleteCar(t)})),this.garage.view.on("startRace",(function(){return n.startRace()})),this.garage.view.on("stopRace",(function(){return n.stopRace()})),this.winners.view.on("sort",(function(t){return n.winners.model.sortWinners(t)})),this.winners.view.on("prevPage",(function(){return n.winners.model.prevPage()})),this.winners.view.on("nextPage",(function(){return n.winners.model.nextPage()}))};var at=new H,st=new function(){var e=this;this.createLinkBlock=function(e,n,r){void 0===r&&(r="");var i=t("div","footer__link"),a=t("a","","".concat(r),i);return a.href=e,a.appendChild(o(n)),i},this.render=function(){return e.footer},this.footer=t("footer","footer");var n=t("div","footer__container","",this.footer);n.append(this.createLinkBlock("https://github.com/M0rl0ck","github","Sergey Sergeev")),n.append(this.createLinkBlock("https://rs.school/js/","logoRss"))},ut=new q,ct=new tt;new e(at,st,ut,ct,new it(ut,ct)).start()})()})();